# $Id: check-common.sh.in,v 1.2 2008/08/09 02:36:18 rockyb Exp $
# -*- shell-script -*-

srcdir=@srcdir@
builddir=@builddir@
if test -z "$THIS_SH" ; then 
  THIS_SH=@BASH_PROG@
fi

# Could/should probably replace all uses of THIS_SH with BASH.
BASH=$THIS_SH

TOP_BUILDDIR=@abs_top_builddir@

export BASH TOP_BUILDDIR

check_output() {
  testfile="$1"
  rightfile="$2"
  # Bourne sh
  # set -o noglob

  @DIFF@ @DIFF_OPTS@ $testfile $rightfile && rm -f $testfile
  return $?
}

# Run the zsh debugger on test program $1 with (optional) zshdb options $2
# using commandfile $3. We assume $TOP_BUILDDIR, $TOP_SRCDIR and
# $TEST_NAME have been set previously
run_debugger() {
  debugged_script=$1
  bashdb_opts=${2:-"-B -q -L ${TOP_BUILDDIR}"}
  cmdfile=${3:-"${TOP_BUILDDIR}/test/data/${TEST_NAME}.cmd"}
  $ZSH ${TOP_BUILDDIR}/bashdb $bashdb_opts -x $cmdfile $debugged_script
}

TEST_FILE="${TOP_BUILDDIR}/test/${TEST_NAME}.check"
RIGHT_FILE="${srcdir}/data/${TEST_NAME}.right"
