# $Id: check-common.sh.in,v 1.7 2008/08/19 22:10:45 rockyb Exp $
# -*- shell-script -*-

srcdir=@srcdir@
builddir=@builddir@
if test -z "$THIS_SH" ; then 
  THIS_SH=@SH_PROG@
fi

# Could/should probably replace all uses of THIS_SH with BASH.
SH=$THIS_SH

top_builddir=@abs_top_builddir@
top_srcdir=@abs_top_srcdir@

export BASH top_builddir top_srcdir srcdir builddir

check_output() {
  testfile="$1"
  rightfile="$2"
  # Bourne sh
  # set -o noglob

  @DIFF@ @DIFF_OPTS@ $testfile $rightfile && rm -f $testfile
  return $?
}

# Run the debugger on test program $1 with (optional) debugger options $2
# using commandfile $3. We assume $top_builddir, $top_srcdir and
# $TEST_NAME have been set previously
run_debugger() {
  debugged_script=$1
  dbg_opts=${2:-"-B -q -L ${top_builddir}"}
  cmdfile=${3:-"${top_builddir}/test/data/${TEST_NAME}.cmd"}
  $SH ${top_builddir}/bashdb $dbg_opts -x $cmdfile $debugged_script
}

TEST_FILE="${top_builddir}/test/${TEST_NAME}.check"
RIGHT_FILE="${top_srcdir}/test/data/${TEST_NAME}.right"
TEST_FILTERED_FILE="/tmp/${TEST_NAME}-filtered.check"
RIGHT_FILTERED_FILE="/tmp/${TEST_NAME}-filtered.right"
